#!/usr/bin/env node
var u=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var S=u((R,p)=>{var n=require("node:fs"),a=require("node:path"),m=require("node:os"),i=process.env.LOCAL_MEMORY_DIR||a.join(m.homedir(),".local-memory"),r=a.join(i,"settings.json"),l={skipTools:["Read","Glob","Grep","TodoWrite","AskUserQuestion"],captureTools:["Edit","Write","Bash","Task"],maxProfileItems:5,debug:!1,injectProfile:!0};function T(){n.existsSync(i)||n.mkdirSync(i,{recursive:!0,mode:448})}function y(){let e={...l};try{if(n.existsSync(r)){let t=n.readFileSync(r,"utf-8");e={...e,...JSON.parse(t)}}}catch(t){console.error(`Settings: Failed to load ${r}: ${t.message}`)}return process.env.LOCAL_MEMORY_SKIP_TOOLS&&(e={...e,skipTools:process.env.LOCAL_MEMORY_SKIP_TOOLS.split(",").map(t=>t.trim())}),process.env.LOCAL_MEMORY_DEBUG==="true"&&(e={...e,debug:!0}),e}function E(e){T();let t={...e};n.writeFileSync(r,JSON.stringify(t,null,2),{mode:384})}function L(e,t){return t.skipTools.includes(e)?!1:t.captureTools&&t.captureTools.length>0?t.captureTools.includes(e):!0}function _(e,t,o){if(e.debug){let s=new Date().toISOString();console.error(o?`[${s}] ${t}: ${JSON.stringify(o)}`:`[${s}] ${t}`)}}p.exports={SETTINGS_DIR:i,SETTINGS_FILE:r,DEFAULT_SETTINGS:l,loadSettings:y,saveSettings:E,shouldCaptureTool:L,debugLog:_}});var f=u((b,d)=>{async function h(){return new Promise((e,t)=>{let o="";process.stdin.setEncoding("utf8"),process.stdin.on("data",s=>{o+=s}),process.stdin.on("end",()=>{try{e(o.trim()?JSON.parse(o):{})}catch(s){t(new Error(`Failed to parse stdin JSON: ${s.message}`))}}),process.stdin.on("error",t),process.stdin.isTTY&&e({})})}function c(e){console.log(JSON.stringify(e))}function I(e=null){c(e?{hookSpecificOutput:{hookEventName:"SessionStart",additionalContext:e}}:{continue:!0,suppressOutput:!0})}function M(e){console.error(`LocalMemory: ${e}`),c({continue:!0,suppressOutput:!0})}d.exports={readStdin:h,writeOutput:c,outputSuccess:I,outputError:M}});var{loadSettings:N,debugLog:O}=S(),{readStdin:$,outputSuccess:g}=f();async function k(){let e=N();try{let t=await $(),o=t.session_id,s=t.tool_name;O(e,"PostToolUse",{sessionId:o,toolName:s}),g()}catch(t){O(e,"Error",{error:t.message}),g()}}k().catch(e=>{console.error(`LocalMemory fatal: ${e.message}`),process.exit(1)});
