#!/usr/bin/env node
var u=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var S=u((v,l)=>{var n=require("node:fs"),a=require("node:path"),m=require("node:os"),i=process.env.LOCAL_MEMORY_DIR||a.join(m.homedir(),".local-memory"),r=a.join(i,"settings.json"),p={skipTools:["Read","Glob","Grep","TodoWrite","AskUserQuestion"],captureTools:["Edit","Write","Bash","Task"],maxProfileItems:5,debug:!1,injectProfile:!0};function T(){n.existsSync(i)||n.mkdirSync(i,{recursive:!0,mode:448})}function y(){let e={...p};try{if(n.existsSync(r)){let t=n.readFileSync(r,"utf-8");Object.assign(e,JSON.parse(t))}}catch(t){console.error(`Settings: Failed to load ${r}: ${t.message}`)}return process.env.LOCAL_MEMORY_SKIP_TOOLS&&(e.skipTools=process.env.LOCAL_MEMORY_SKIP_TOOLS.split(",").map(t=>t.trim())),process.env.LOCAL_MEMORY_DEBUG==="true"&&(e.debug=!0),e}function E(e){T();let t={...e};n.writeFileSync(r,JSON.stringify(t,null,2))}function L(e,t){return t.skipTools.includes(e)?!1:t.captureTools&&t.captureTools.length>0?t.captureTools.includes(e):!0}function _(e,t,s){if(e.debug){let o=new Date().toISOString();console.error(s?`[${o}] ${t}: ${JSON.stringify(s)}`:`[${o}] ${t}`)}}l.exports={SETTINGS_DIR:i,SETTINGS_FILE:r,DEFAULT_SETTINGS:p,loadSettings:y,saveSettings:E,shouldCaptureTool:L,debugLog:_}});var f=u((R,d)=>{async function h(){return new Promise((e,t)=>{let s="";process.stdin.setEncoding("utf8"),process.stdin.on("data",o=>{s+=o}),process.stdin.on("end",()=>{try{e(s.trim()?JSON.parse(s):{})}catch(o){t(new Error(`Failed to parse stdin JSON: ${o.message}`))}}),process.stdin.on("error",t),process.stdin.isTTY&&e({})})}function c(e){console.log(JSON.stringify(e))}function I(e=null){c(e?{hookSpecificOutput:{hookEventName:"SessionStart",additionalContext:e}}:{continue:!0,suppressOutput:!0})}function M(e){console.error(`LocalMemory: ${e}`),c({continue:!0,suppressOutput:!0})}d.exports={readStdin:h,writeOutput:c,outputSuccess:I,outputError:M}});var{loadSettings:$,debugLog:O}=S(),{readStdin:N,outputSuccess:g}=f();async function b(){let e=$();try{let s=(await N()).session_id;O(e,"UserPromptSubmit",{sessionId:s}),g()}catch(t){O(e,"Error",{error:t.message}),g()}}b().catch(e=>{console.error(`LocalMemory fatal: ${e.message}`),process.exit(1)});
